/*
 Generated by javascript
 @file 公众号微信开发
 @author TimYao <tmwoman@yeah.net>
 @version 20150729
 */

Zepto(function($){
   //比例不同设置相对不同的HTML fontsize
   (function(){  
   	  //参数设置
      var g = (this===window) ? $(this) : $(window),
          maxWidth = 640,
          w = g.width(),
          html = $('html'),
          fontSize = 16,
          setW;
      //设置比例
      function setHtmlFontsize()
	    { 
         setW = w>maxWidth?maxWidth:w;
         html.css("fontSize",setW/fontSize);
	    }
	    setHtmlFontsize();
   }).call(this); 
   
   //弹层
   (function(){
      var g = (this===window) ? $(this) : $(window),
          triggerlayer = $(".triggerlayer") || {},
          layerTab = $(".layerTab") || {},
          datalayer = 'layerTab',
          slidemovec = $(".slidemovec") || {},
          pwrap = $('.pwrap') || {},
          dataidflg = false,
          datalayerobj = null,
          slideMapMove = $(".slideMapMove") || {},
          l = 0,
          i = 0;
      if(triggerlayer.length<=0 && layerTab.length<=0)
      {
          return false;
      }
      
      for(i,l=triggerlayer.length;i<l;i++)
      {
           (triggerlayer.eq(i))[0].flg = false;
      }
      $(document).on('click','.triggerlayer',function(event){
          var datalayerflg = $(this).attr('data-layer') || datalayer;
          var dataid = ($(this).attr('data-id')) ? ($(this).attr('data-id')) : (dataidflg==false) ? 'no':1;
          trigger($(this),datalayerflg,dataid);
          if(slidemovec.length>0 && pwrap.length>0)
          {
              slidemovec.css("top",pwrap.height());
          }
          event.stopPropagation();
          event.preventDefault();
          return false;
      });
      function trigger(obj,datalayerflg,dataid)
      {
          var ob = obj[0];
          layerTab.attr({'id':datalayer+dataid});
          if(ob.flg===false)
          {
             $("#"+(datalayer+dataid)).show();
             $(document.body).append($("<div class='layerMark'></div>"));
             ob.flg = true;
             datalayerobj = $("#"+(datalayer+dataid));
             triggerMark(ob);
          }else{
             $("#"+(datalayer+dataid)).hide();
             ob.flg = false;
             $(".layerMark").remove();
          }
      };
      function triggerMark(ob)
      {
          $(".layerMark").on('click',function(event){
              ob.flg = false;
              datalayerobj.hide();
              datalayerobj = null;
              $(this).remove();
              event.stopPropagation();
              return false;
          })
      };
   }).call(this);

   //筛选
   (function(){
     var g = (this===window) ? $(this) : $(window);
     filterFun = function(dataArrs)
     {      
         var w = parseFloat(g.width(),10),
             h = parseFloat(g.height(),10),
             filterResult = $("#filterResult") || {},
             filteContent = $("#filteContent") || {},
             leftNav = $('#leftNav') || {},
             rightContent = $("#rightContent") || {},
             subul = $("#subul") || {},
             submitBtn = $("#submitBtn") || {},
             curindex = 0, //记录当前索引
             rootIndex = 0,
             dataflg = '',
             allFlg = [],
             leftli = null,
             ulist = null,
             filterFun = null,
             topH = 0;
         var dataArr = dataArrs || {};  
         if((leftNav.length<0 || rightContent.length<0) && filteContent.length<0)
         {
             return false;
         }
         //存储导航flg ,取数据时用到标签，防止后期更改
         leftNav.children('li').each(function(i,n){
            allFlg[i] = $(n).attr('data-flg');
         });
      
         //设置菜单高度
         function setHeight()
         {  
            topH = (filterResult.length>0) ? (parseFloat(filterResult.height(),10)) : 0;
            //subul.length>0 ? (subul.find('ul').height(h-topH)) : 0;
            rightContent.length>0 ? (rightContent.width(w-leftNav.width())) :0 ;
            filteContent.height((h-topH));
            filteContent.css({"top":topH});
         };
         //调用默认数据
         function defaultData()
         {
            if(!isEmptyObj(dataArr))
            {
                addTopData();
                addCurrentClass();
                setHeight();
            }
         };
         //左侧栏目
         function addClick()
         {
            leftli = leftNav.find('li');
            ulist = rightContent.children('ul');
            leftli.on('click',function(event){
              var index = $(this).index();
              rootIndex = index;
              var tagflg = ($(this).attr('data-flg')).toLowerCase();
              $(this).addClass('root').siblings().removeClass('root');
              dataflg = tagflg;
              subul.hide();
              ulist.hide();
              ulist.eq(index).show();
              adderjiclick(ulist.eq(index),index);
              scrollFun(ulist.eq(index));
              //判断是否选择租金栏启动手动填写数据
              tagflg === 'rent' ? (fillIn(tagflg)) : 0;
              event.stopPropagation();
              event.preventDefault();
              return false;
            });
         };
         //子菜单添加事件
         function adderjiclick(obj,i)
         {
            var subli = obj.find('li');
            if(subli.length<0)
            {
               return false;
            }
            subli.off('click');
            subli.on('click',function(event){
              var index = $(this).index();
              var thisDataId = $(this).attr('data-id');
              //排除租金选项手动填写栏目点击事件
              if($(this).hasClass('noclick'))
              {
                   return false;
              }
              curindex = index;
              var thisDataId = $(this).attr('data-id');
              $(this).addClass('root').siblings().removeClass('root');
              $(this).find('i').addClass('iconfont').addClass('icon-xuanzhong');
              $(this).siblings().find('i').removeClass('iconfont').removeClass('icon-xuanzhong');
              
              //处理请求数据重置为一级位置数据
              for(var c in dataArr)
              {
                  if(c.indexOf('positionid')!=-1 && dataArr[c.toLowerCase()]==thisDataId)
                  {
                      break;
                  }
                  if(i==0)
                  {
                     if(c.indexOf('position')!=-1 || c.indexOf('positionsub')!=-1)
                     {
                         delete dataArr[c];
                     }
                  }
              }
              dataArr[dataflg+'id'] = thisDataId;
              dataArr[dataflg+'text'] = $.trim($(this).text());
              //三级添加事件请求数据
              //i=0为位置数据请求，其他不需请求
              i===0 ? (reponseDate(thisDataId,dataArr),subul.show(),subul.find('li').removeClass('root')) : ($(this).parent('ul').hide(),leftNav.find('li').removeClass('root'),rootIndex=0);
              addTopData();   
              event.stopPropagation();
              event.preventDefault();
              return false;
            });
         };
         //位置三级数据请求
         function reponseDate(thisDataId,dataArr)
         {  
            $.ajax({
               url:'test.php',
               type:'get',
               data:{
                  dataid:thisDataId
               },
               success:function(reponse)
               {
                  var rep = eval('('+reponse+')');
                  //rep.status = true
                  if(rep.status)
                  {

                      subul.html('');
                      subul.append(rep.html);
                      /*for(var c in dataArr)
                      { 
                          if(dataArr[c.toLowerCase()]==thisDataId)
                          {
                              break;
                          }
                          if(c.indexOf('positionsubid')!=-1 || c.indexOf('positionsubtext')!=-1)
                          {
                              delete dataArr[c];
                              //删除tab标签
                              deleteTab();
                          }
                      }*/
                      var ul = subul.find('ul');
                      addCheck();
                      scrollFun(ul);
                  }else{
                     alert('数据请求失败!');
                  }
               },
               error:function()
               {
                  alert('服务器失败！');
               }
            });    
         };
         //三级位置菜单点选
         function addCheck()
         {
            subul.find('li').find('i').removeClass('leftj');
            subul.find('li').eq(curindex).find('i').eq(0).addClass('leftj');
            var sublibtn = subul.find('li');
            addCurrentClass();
            sublibtn.on('click',function(event){
              var thisDataId = $(this).attr('data-id');
              dataArr['positionsubid'] = thisDataId;
              dataArr['positionsubtext'] = $.trim($(this).text());
              $(sublibtn).removeClass('root').find('i').removeClass('dh');
              $(this).addClass('root');
              addTopData();
              $(this).find('i').eq(1).addClass('dh');
              event.stopPropagation();
              event.preventDefault();
              return false;
            });
         };
         //添加头部数据
         function addTopData()
         {   
             //再存有选中的数据时操作
             if(dataArr!=null && dataArr)
             {  
                 var l = allFlg.length;
                 var ob = {}; 
                 for(var i=0;i<l;i++)
                 {
                     var datas = [];
                     for(var a in dataArr)
                     {
                         var tag1 = (allFlg[i]).toLowerCase();
                         var tag = a.substring(0,tag1.length).toLowerCase();
                         if(tag === tag1)
                         {   
                             ob[tag] = {};
                             datas.push(dataArr[a]);
                             ob[tag]['datas'] = datas;
                         }
                     }
                 }
                 //创建标签
                 createLable(ob);
             }
         };
         //创建头部点选数据
         function createLable(datas)
         {  
            var oul = filterResult.find('ul'),
                ali = oul.find('li'),
                tijiao = $('#tijiao'),
                l = ali.length;
            oul.html('');
            for(var a in datas)
            {
                creatTab(a,datas[a]['datas']); 
            }
            function creatTab(a,datarr)
            {
               var k = datarr.length/2;
               for(var i=0;i<k;i++)
               {  
                  var m = i*2;
                  var html = $("<li data-flg="+a+" data-id="+datas[a]['datas'][m]+"><span>"+datas[a]['datas'][(m+1)]+"</span><i class='iconfont icon-iconfontguanbi2'></i></li>")
                  oul.append(html);
               }
               
            }
            //提交按钮存在选项后展示
            if(tijiao && tijiao.length>0)
            {
                $('#tijiao').show();
                filterResult.addClass('filterpadding');
                //启动删除头部tab函数
                addTopTabClick();
                submitFun();
                setHeight();
            }
         };
         //增加删除头部tab事件
         function addTopTabClick()
         {
             var ul = filterResult.find('ul'),
                 li = ul.find('li'),
                 l = li.length,
                 i = 0;
             if(l>0)
             {
                 li.find('.icon-iconfontguanbi2').on('click',function(event){
                     var thisFlg = ($(this).parent().attr('data-flg')).toLowerCase();
                     var index = $(this).parent().index();
                     var thisId = $(this).parent().attr('data-id');
                     if(!thisFlg)
                     {
                        return false;
                     }
                     if(!isEmptyObj(dataArr))
                     {
                         for(var d in dataArr)
                         {
                             var tag = d.substring(0,thisFlg.length).toLowerCase();
                             if(tag===thisFlg)
                             {
                               //位置菜单删除
                               if(thisFlg=='position')
                               {  

                                  if(index>0)
                                  {  
                                     var kid = thisFlg+'subid';
                                     var ktext = thisFlg+'subtext'; 
                                     delete dataArr[kid];
                                     delete dataArr[ktext];
                                     break;
                                  }else{
                                     delete dataArr[d];
                                  }
                               }else{
                               //其他分类删除
                                  delete dataArr[d];
                               }
                             }
                         }
                         //删除标签
                         deleteTab($(this).parent());
                     }
                     event.stopPropagation();
                     event.preventDefault();
                     return false;
                 });
             }
         };
         //删除标签
         function deleteTab(obj)
         {  
             var ul = filterResult.find('ul'),
                 li = ul.find('li'),
                 l = li.length,
                 aUl = rightContent.children('ul'),
                 tijiao = $("#tijiao");
             //删除指定标签    
             if(obj)
             {  
                var lis = aUl.eq(rootIndex).find('li');
                var index = obj.index();
                var dataflg = (obj.attr('data-flg')).toLowerCase();
                var dataid = obj.attr('data-id');
 
                //删除位置双级菜单当前样式变换
                if(dataflg=='position')
                { 
                    if(dataflg=='position' && index>0)
                    {
                       subul.find('li').each(function(i,n){if($(n).attr('data-id')===dataid){var thisobj = $(n);thisobj.removeClass('root').find('i').removeClass('dh');}});
                    }else{
                       for(var i=0;i<l;i++)
                       {
                           var f = (li.eq(i).attr('data-flg')).toLowerCase();
                           if(f===dataflg)
                           {
                               li.eq(i).remove();
                               li.eq(i).removeClass('root').find('i').removeClass('dh');
                           }
                       }
                       rightContent.find('ul').eq(0).find('li').removeClass('root').find('i').removeClass();
                       subul.find('li').removeClass('root').find('i').removeClass('dh');
                    }
                }else{
                //删除其他分类当前样式   
                   leftNav.find('li').each(function(i,n){
                       if($(n).attr('data-flg').toLowerCase()===dataflg)
                       {
                            aUl.eq(i).find('li').removeClass('root').find('i').removeClass();
                       }
                   });
                }
                obj.remove();
                //无数据提交按钮隐藏 去掉当前选标注
                ul.find('li').length<=0 ? (leftNav.find('li').removeClass('root'),rootIndex=0,rightContent.children().hide(),dataArr={},tijiao.length>0 ?  (tijiao.hide(),filterResult.removeClass('filterpadding')) : 0) : (tijiao.show(),filterResult.addClass('filterpadding'));
             }else{
               for(var i=0;i<l;i++)
               {
                   var thisflg = (li.eq(i).attr('data-flg')).toLowerCase();
                   var thisindex = li.eq(i).index();
                   //删除重置位置标签
                   if(thisflg && thisflg == 'position' && thisindex!=0)
                   {
                        li.eq(i).remove();
                   }
               }
             }
             setHeight();
         };
         //手动填写租金数据
         function fillIn(tags)
         {
             var fillin = $('.fillin'),
                 aInput = fillin.find('.textlabel').find('input'),
                 btnsubmit = fillin.find('.btnlabel').find('input'), 
                 value,
                 flg = true, //总开关
                 tagflg = 'rent',
                 url = 'test.php',
                 regNumber = /^\d+$/;
             if(fillin.length>0 && aInput.length>0 && btnsubmit.length>0)
             {
                  //分类开关
                  for(var i=0;i<aInput.length;i++)
                  {
                      (aInput.eq(0))[0].flg = false;
                  }
                  aInput.on('input',function(){
                      value = $.trim($(this).val());
                      if(regNumber.test(value))
                      { 
                          ($(this)[0]).flg = true;
                      }else{
                          ($(this)[0]).flg = false;
                      }
                      checkSubmit();
                  });
                  checkSubmit();
             } 
             //匹配看是否可以提交 
             function checkSubmit()
             { 
                for(var j=0;j<aInput.length;j++)
                {   
                    if((aInput.eq(j))[0].flg===true)
                    {  
                        flg = true;
                        continue;
                    }else{
                        flg = false;
                        break;
                    }
                }
                //满足为空或者前者大于后者不提交
                if($.trim(aInput.eq(0).val())=='' || $.trim(aInput.eq(1).val())=='' || !regNumber.test($.trim(aInput.eq(0).val())) || !regNumber.test($.trim(aInput.eq(1).val())))
                {   
                    flg = false;
                }else{
                    if(Number($.trim(aInput.eq(0).val()),10)>=Number($.trim(aInput.eq(1).val()),10))
                    {
                        flg = false; 
                    }else{
                        flg = true;
                    }
                }
                if(flg)
                {
                   btnsubmit.addClass('root');    
                   subForm();
                }else{
                   btnsubmit.removeClass('root');    
                }
             }
             //提交插入数据
             function subForm()
             {
                 btnsubmit.off('click');
                 btnsubmit.on('click',function(event){
                    var v1 = $.trim(aInput.eq(0).val());
                    var v2 = $.trim(aInput.eq(1).val());
                    //flg==false阻止提交
                    if(flg===false)
                    {
                       return false;
                    }
                    //先将创建数据插入数据库，然后返回给我数据ID 
                    $.ajax({
                       type:'POST',
                       url:url,
                       async:true,
                       data:{
                          v1:v1,
                          v2:v2
                       },
                       success:function(reponse)
                       {
                           var rep = eval('('+reponse+')');
                           if(rep.status) //为true插入数据成功
                           {
                               if(!isEmptyObj(dataArr))
                               {
                                    for(var a in dataArr)
                                    {

                                        var tag = a.substring(0,tagflg.length).toLowerCase();
                                        if(tag==tagflg)
                                        {
                                            delete dataArr[a]; 
                                            //删除tab标签
                                             deleteTab();
                                        }
                                    }
                               }
                               //清除之前已经点选项目
                               btnsubmit.parents('.fillin').siblings().removeClass('root').find('i').removeClass();
                               //重新插入数据
                               dataArr[tags+'id'] = rep.msg;
                               dataArr[tags+'text'] = v1.toString()+'-'+v2.toString()+'元';
                               addTopData();
                           }
                       },
                       error:function()
                       {
                           alert('服务器添加数据失败！');
                       }
                    });
                    event.stopPropagation();
                    event.preventDefault();
                    return false;
                 });
             }
         };
         //添加样式
         function addCurrentClass()
         {
             var leftli = leftNav.find('li'),
                 index = 0;
             if(!isEmptyObj(dataArr))
             {
                var childrenlist = rightContent.children('ul'),
                    currentObj = null,
                    currentlis = null,
                    k=0,
                    l=0;
                for(var a in dataArr)
                {   
                    //位置
                    if(a.toLowerCase().indexOf('position')!=-1)
                    {    
                         searchiIndex('position');
                         currentObj = childrenlist.eq(index);
                         currentlis = currentObj.find('li');
                         l = currentlis.length;
                         for(k;k<l;k++)
                         {
                            var dataid = currentlis.eq(k).attr('data-id');
                            if(dataid && dataid==dataArr[a])
                            {   
                                currentlis.eq(k).addClass('root').find('i').addClass('iconfont').addClass(' icon-xuanzhong');
                                break;
                            }
                         }
                         //子位置
                         if(a.toLowerCase().indexOf('positionsubid')!=-1)
                         { 
                             currentObj = subul.find('.subul');
                             currentlis = currentObj.find('li');
                             k = 0;
                             l = currentlis.length;
                             for(k;k<l;k++)
                             {
                                  var dataid = currentlis.eq(k).attr('data-id');
                                  if(dataid && dataid==dataArr[a])
                                  {   
                                      currentlis.eq(k).addClass('root').find('i').eq(1).addClass('dh');
                                      break;
                                  }
                             }
                         }
                    }
                
                    //其他
                    if(a.toLowerCase().indexOf('position')==-1)
                    {
                        if(a.toLowerCase().indexOf('shop')!=-1)
                        {  
                            searchiIndex('shop');
                            currentObj = childrenlist.eq(index);
                        }
                        if(a.toLowerCase().indexOf('scope')!=-1)
                        {
                            searchiIndex('scope');
                            currentObj = childrenlist.eq(index);
                        }
                        if(a.toLowerCase().indexOf('rent')!=-1)
                        {
                            searchiIndex('rent');
                            currentObj = childrenlist.eq(index);
                        }
                        if(a.toLowerCase().indexOf('area')!=-1)
                        {
                            searchiIndex('area');
                            currentObj = childrenlist.eq(index);
                        }
                        currentlis = currentObj.find('li');
                        l = currentlis.length;
                        k=0;
                        for(k;k<l;k++)
                        {
                          var dataid = currentlis.eq(k).attr('data-id');
                          if(dataid && dataid==dataArr[a])
                          {   
                              currentlis.eq(k).addClass('root').find('i').addClass('iconfont').addClass(' icon-xuanzhong');
                              break;
                          }
                        }
                    }
                }
             }
             //寻找对应索引
             function searchiIndex(flg)
             {
                leftli.each(function(i,obj){
                   var flgtag = $(obj).attr('data-flg');
                   if(flgtag==flg)
                   {
                        index = i;
                        return false;
                   }
                });
             }
             setHeight();
         };
         //提交
         function submitFun()
         {
              if(submitBtn.length>0)
              {
                 submitBtn.off('click');
                 submitBtn.on('click',function(event){
                    dataFormat(dataArr);
                    $(this).parents('form').submit();
                    event.stopPropagation();
                    event.preventDefault();
                    return false;
                 });
              }
         };
         //数据格式处理
         function dataFormat(data)
         {
            var hideData = $("#hideData");
            var lastData = '';
            if(!isEmptyObj(data) && hideData.length>0)
            {
                for(var a in data)
                {
                    if(a.toLowerCase().lastIndexOf('id')!=-1)
                    {
                        lastData += a+'='+data[a]+'&';
                    }
                }
            }
            lastData!=''?(lastData=lastData.substring(0,lastData.lastIndexOf('&')),hideData.val(lastData)) : (lastData='',hideData.val(''));
         };
         //验证json对象是否为空
         function isEmptyObj(obj)
         {
             var i = 0;
             for(var a in obj)
             {
                 if(a)
                 {
                    i++;
                 }
             }
             if(i>0)
             {
                return false;
             }else{
                return true;
             }
         };
         //滑动
         function scrollFun(obj)
         {    
            var ob = obj[0];
            if(parseFloat(obj.height())<=parseFloat(rightContent.height()))
            {
                 return false;
            }
            ob.h = Math.abs(parseFloat(rightContent.height()-obj.height()));
            ob.flx = -1;
            ob.x=ob.x1=ob.y=ob.y1=ob.disx=ob.disy=ob.newy=ob.stepx=ob.stepy=ob.t=0;
            $(obj).off('touchstart');
            $(obj).off('touchmove');
            $(obj).on('touchstart',function(event){
                  ob.x = event.touches[0].pageX;
                  ob.y = event.touches[0].pageY;
                  preventDocumentScorll(true);
            });
            $(obj).on('touchmove',function(event){
                  ob.x1 = event.touches[0].pageX;
                  ob.y1 = event.touches[0].pageY;
                  ob.disx = ob.x-ob.x1;
                  ob.disy = ob.y-ob.y1;
                  ob.disy = ob.disy/2;
                  if(Math.abs(ob.disy)>Math.abs(ob.disx))
                  {   
                      if(ob.y>ob.y1)
                      { 
                         ob.newy = ob.disy+Math.abs(ob.stepy);
                         ob.flx = -1; 
                         if(Math.abs(ob.newy)>=ob.h)
                         {
                             ob.newy = ob.h;
                         }
                      }else{
                         ob.newy = ob.stepy-ob.disy;
                         ob.flx = 1; 
                         if(ob.newy>=0)
                         {
                              ob.newy = 0;
                         }
                      }
                      //步长改变
                      ob.stepy = ob.flx*ob.newy;
                      $(this).css({
                         '-webkit-transform':'translate(0px,'+ob.stepy+'px)',
                         '-webkit-transition':'-webkit-transform 0ms cubic-bezier(0.33,0.66,0.66,1)',
                         'transform':'translate(0px,'+ob.stepy+'px)',
                         'transition':'transform 0ms cubic-bezier(0.33,0.66,0.66,1)'
                      });
                  }
                  ob.x = ob.x1;
                  ob.y = ob.y1;
                  preventDocumentScorll(true);  
            });
         };
         //阻止开启默认滑动
         function preventDocumentScorll(flg)
         {
            if(flg==true)
            {
                g.on('touchmove',function(event){
                      event.preventDefault();
                      return false;
                });
            }else{
                g.off('touchmove');
            }
         };  
        setHeight();
        addClick();
        defaultData();
     };
     filterFun.call(g); 
     g[0].filterSearch = {};
     g[0].filterSearch.filterFun = filterFun;
   }).call(this);

   //幻灯滑动[左右滑动]
   (function(){
      var g = (this===window) ? $(this) : $(window),
          w = g.width(),
          pro = 640/400,
          gobal = g[0],
         _fun = (function(){
          var scrollcontrl = $('.scrollcontrl') || {};
          if(scrollcontrl.length<=0)
          {   
              return false;
          }
          //对象分散变量
          for(var j=0;j<scrollcontrl.length;j++)
          {
              scrollcontrl[j].mainConiter = null;
              scrollcontrl[j].divnumber = null;
              scrollcontrl[j].l = 0;
              scrollcontrl[j].pich = 0
              scrollcontrl[j].flx = -1;
              scrollcontrl[j].n =0;
              scrollcontrl[j].x =0;
              scrollcontrl[j].x1 =0;
              scrollcontrl[j].y =0;
              scrollcontrl[j].y1 =0;
              scrollcontrl[j].total =0;
              scrollcontrl[j].cur =0;
              startMove(scrollcontrl[j]);
          }

          function startMove(scrollcontrl)
          {
              var l = scrollcontrl.l,
                  mainConiter = scrollcontrl.mainConiter,
                  divnumber = scrollcontrl.divnumber,
                  flx = scrollcontrl.flx,
                  n = scrollcontrl.n,
                  x = scrollcontrl.x,
                  x1 = scrollcontrl.x1,
                  y = scrollcontrl.y,
                  y1 = scrollcontrl.y1,
                  total = scrollcontrl.total, 
                  cur = scrollcontrl.cur;

              l = $(scrollcontrl).find('li').length;
              mainConiter = $(scrollcontrl).parents('.soliders');
              mainConiter.height(w/pro);
              $(scrollcontrl).find('li').width(w).height(w/pro);
              $(scrollcontrl).width(l*w);
              divnumber = mainConiter.children('.divnumber') || {};
              divnumber.length>0 ? (cur = n+1,total=l,divnumber.find('.num').find('em').html(cur),divnumber.find('.num').find('i').html(total)) : 0;
              //控制滑动方向控制屏幕其他滑动影响问题
              mainConiter.on('touchstart',function(event){
                  x = event.touches[0].pageX;
                  y = event.touches[0].pageY;
                  //event.stopPropagation();
              });
              mainConiter.on('touchmove',function(event){
                 x1 = event.touches[0].pageX;
                 y1 = event.touches[0].pageY;
                 if(Math.abs(x-x1)>Math.abs(y-y1))
                 {   
                     preventDocumentScorll(true);
                 }else{
                     preventDocumentScorll(false); 
                 } 
                 //event.stopPropagation();
                 //return false;
              });
              /*mainConiter.on('touchend',function(event){
                  event.stopPropagation();
              });*/
              mainConiter.swipeLeft(function(event){
                  if(n>=l-1)
                  {
                     return false;
                  }
                  flx *= 1;
                  n++;
                  $(scrollcontrl).css({'-webkit-transform':'translate('+(n*w)*flx+'px)','-webkit-transition':'-webkit-transform 500ms linear','transform':'translate('+(n*w)*flx+'px)','transition':'transform 500ms linear'});
                  cur = n+1;
                  divnumber.find('.num').find('em').html(cur);
                  preventDocumentScorll(false);
                  event.stopPropagation();
              });
              mainConiter.swipeRight(function(event){
                  if(n<=0)
                  {
                     return false;
                  }
                  flx *= 1;
                  n--;
                  $(scrollcontrl).css({'-webkit-transform':'translate('+(n*w)*flx+'px)','-webkit-transition':'-webkit-transform 500ms linear','transform':'translate('+(n*w)*flx+'px)','transition':'transform 500ms linear'});
                  cur = n+1;
                  divnumber.find('.num').find('em').html(cur);
                  preventDocumentScorll(false);
                  event.stopPropagation();
              });
          };
          
          function preventDocumentScorll(flg)
          {
              if(flg==true)
              {
                  g.on('touchmove',function(event){
                        event.preventDefault();
                        return false;
                  });
              }else{
                  g.off('touchmove');
              }
          };    
         });
         _fun();
      gobal.publicNumber = {};
      gobal.publicNumber.soliders = _fun;
   }).call(this);
    
   //首页底部幻灯[连续滑动]
   (function(){
      var g = (this===window) ? $(this) : $(window),
          solider = $("#solider"),
          oul = solider.find('ul'),
          ol = solider.find('ol'),
          w = g.width(),
          li = oul.find('li'),
          oli = ol.find('li'),
          len01 = li.length,
          len02 = oli.length,
          x = 0,
          x1 = 0,
          y1 = 0,
          y = 0,
          i = 0,
          t0 = 3000,
          timer = null,
          t = 400,//运动时间
          sport = 'linear',//滑动模式
          flx = -1;
      if(solider.length<=0)
      {
          return false;
      }
      li.width(w);
      
      var lastli = li.eq(0).clone();
      oul.append(lastli);
      oul.css("width",oul.find('li').length*w);
      var n = oul.find('li').length;
      oli.eq(0).addClass('cur');
      //控制滑动是静止页面默认滑动
      solider.on('touchstart',function(event){
          x = event.touches[0].pageX;
          y = event.touches[0].pageY;
      });
      solider.on('touchmove',function(){
         x1 = event.touches[0].pageX;
         y1 = event.touches[0].pageY;
         if(Math.abs(x-x1)>Math.abs(y-y1))
         {   
             preventDocument(true);
         }else{
             preventDocument(false); 
         } 
      });
      //左滑动
      solider.swipeLeft(function(){
          tab();
          clearInterval(timer);
          timer = null;
          auto();
      });
      //右滑动
      solider.swipeRight(function(){
          clearInterval(timer);
          timer = null;
          if(i<=0)
          { 
             i=len01;
             oul.css({'-webkit-transition':'0s',"-webkit-transform":"translate("+flx*(i*w)+"px)",'transition':'0s',"transform":"translate("+flx*(i)*w+"px)"});
             oli.eq(i).addClass('cur');
          }
          i--;
          setTimeout(function(){
             oul.css({"-webkit-transform":"translate("+(i*w)*flx+"px)","-webkit-transition":"-webkit-transform "+t+"ms "+sport,"transform":"translate("+(i*w)*flx+"px)","transition":"transform "+t+"ms "+sport});   
             oli.removeClass('cur');
             oli.eq(i).addClass('cur');
          },t);
          preventDocument(false); 
          auto(); 
      });
      auto();
      function tab()
      {
          i++;
          oul.css({"-webkit-transform":"translate("+(i*w)*flx+"px)","-webkit-transition":"-webkit-transform "+t+"ms "+sport,"transform":"translate("+(i*w)*flx+"px)","transition":"transform "+t+"ms "+sport});
          oli.removeClass('cur');
          oli.eq(i).addClass('cur');
          preventDocument(false);
          if(i>=len01)
          { 
             i=0;
             setTimeout(function(){
                oul.css({'-webkit-transition':'0s',"-webkit-transform":"translate(0px)",'transition':'0s',"transform":"translate(0px)"});
                oli.eq(i).addClass('cur');
             },t);
          }
      }
      //自动
      function auto()
      {  
          clearInterval(timer);
          timer = null;
          timer = setInterval(function(){
            tab();
          },t0);
      }
      //阻止文档滑动影响左右滑动
      function preventDocument(flg)
      {
         if(flg)
         {
            $(g).on('touchmove',function(event){
             event.stopPropagation();
             return false;
            });
         }else{
            $(g).off('touchmove');
         }
      }
   }).call(this);

   //首页到栏目滑动
   (function(){
      var g = (this===window) ? $(this) : $(window),
          scorllWrap = $("#scorllWrap"),
          listWrap = scorllWrap.find('.listWrap'),
          listWrapW = listWrap.width(),
          ol = scorllWrap.find('ol'),
          w = g.width(),
          oli = ol.find('li'),
          len01 = listWrap.find('.listContent').length,
          len02 = oli.length,
          x = 0,
          x1 = 0,
          y1 = 0,
          y = 0,
          i = 0,
          k = 0,
          flx = -1;
      oli.eq(i).addClass('cur');
      //k = Math.round(100/len01);
      k = 33;
      //控制滑动是静止页面默认滑动
      scorllWrap.on('touchstart',function(event){
          x = event.touches[0].pageX;
          y = event.touches[0].pageY;
      });
      scorllWrap.on('touchmove',function(){
         x1 = event.touches[0].pageX;
         y1 = event.touches[0].pageY;
         if(Math.abs(x-x1)>Math.abs(y-y1))
         {   
             preventDocument(true);
         }else{
             preventDocument(false); 
         } 
      });
      scorllWrap.swipeLeft(function(){
          if(i>=len01-1)
          {
             return false;
          }
          flx *= 1;
          i++;
          $(listWrap).css({'-webkit-transform':'translate('+(i*k)*flx+'%)','-webkit-transition':'-webkit-transform 500ms linear','transform':'translate('+(i*k)*flx+'%)','transition':'transform 500ms linear'});
          oli.removeClass('cur');
          oli.eq(i).addClass('cur');
          preventDocument(false);
      });
      scorllWrap.swipeRight(function(){
          if(i<=0)
          {
             return false;
          }
          flx *= 1;
          i--;
          $(listWrap).css({'-webkit-transform':'translate('+(i*k)*flx+'%)','-webkit-transition':'-webkit-transform 500ms linear','transform':'translate('+(i*k)*flx+'%)','transition':'transform 500ms linear'});
          oli.removeClass('cur');
          oli.eq(i).addClass('cur');
          preventDocument(false);
      });
      //阻止文档滑动影响左右滑动
      function preventDocument(flg)
      {
         if(flg)
         {
            $(g).on('touchmove',function(event){
             event.stopPropagation();
             return false;
            });
         }else{
            $(g).off('touchmove');
         }
      }    
   }).call(this);
    
   //联想搜索功能
   (function(){
       var g = (this===window) ? $(this) : $(window),
           search = $("#search") || {},
           searchinput = null,
           cancelBtn01 = null,
           cancelBtn02 = null,
           searchlist = null,
           searchInfor = null,
           url = 'test.php'; //数据联想请求地址
       if(search.length<=0)
       {
           return false;
       }
       searchinput = $("#searchinput");
       cancelBtn01 = $("#cancelBtn01"); 
       cancelBtn02 = $("#cancelBtn02"); 
       searchlist = $("#searchlist");
       searchInfor = $(".searchInfor");

       if(searchinput.length<=0 || cancelBtn01.length<=0 || cancelBtn02.length<=0 || searchlist.length<=0)
       {
           return false;
       }
       
       searchinput.on('keyup',function(event){
           var v = $.trim($(this).val());
           if(v.length>0)
           {
               association(v);
           }else{
               searchinput.val('');
               cancelBtn01.hide();
               cancelBtn02.hide();
               searchlist.html('');
               $('#last').length>0 ? ($('#last').hide()) : 0;
               searchInfor.length >0 ? (searchInfor.hide()) : 0;
               searchinput.parents('.searchw').removeClass('fl');
           } 
           event.stopPropagation();
           return false;
       });
       
       //association 联想
       function association(v)
       {
          $.ajax({
             type:'GET',
             async:true,
             url:url,
             data:{
                data:v
             },
             success:function(reponse)
             {
                 var rep = eval('('+reponse+')');
                 searchinput.parents('.searchw').addClass('fl');
                 //取消按钮
                 cancelBtn01.show();
                 cancelBtn02.show();
                 cancelFun(cancelBtn01);
                 cancelFun(cancelBtn02);
                 if(rep.status)  //true
                 {
                     var html = rep.html;
                     searchlist.append($(html));

                     searchInfor.length >0 ? (searchInfor.hide()) : 0;
                     //清空记录展示 
                     $('#last').length>0 ? ($('#last').show()) : 0;
                 }else{
                     searchInfor.length >0 ? (searchInfor.show()) : 0;
                     $('#last').length>0 ? ($('#last').hide()) : 0;
                 }
             },
             error:function()
             {
                 alert("服务器请求失败！");
             }
          });  
       };
       function cancelFun(btn)
       {
           btn.on('click',function(event){
               searchinput.val('');
               cancelBtn01.hide();
               cancelBtn02.hide();
               searchlist.html('');
               $('#last').length>0 ? ($('#last').hide()) : 0;
               searchInfor.length >0 ? (searchInfor.hide()) : 0;
               searchinput.parents('.searchw').removeClass('fl');
               event.stopPropagation();
               event.preventDefault();
               return false;
           });
       }
   }).call(this);  

   //地图底部滑动
   (function(){
     var g = (this===window) ? $(this) : $(window),
         dlistwrap = $("#dlistwrap"),
         mapdata = dlistwrap.find('.mapdata'),
         l = mapdata.length,
         w = g.width(),
         x = 0,
         x1 = 0,
         y1 = 0,
         y = 0,
         i = 0,
         k=0,
         flx = -1;
      if(dlistwrap.length<=0)
      {
          return false;
      }
      dlistwrap.width(l*100+'%');
      //k = (100/l);
      k = mapdata.eq(0).width()+4;
      //控制滑动是静止页面默认滑动
      dlistwrap.on('touchstart',function(event){
          x = event.touches[0].pageX;
          y = event.touches[0].pageY;
      });
      dlistwrap.on('touchmove',function(event){
         x1 = event.touches[0].pageX;
         y1 = event.touches[0].pageY;
         if(Math.abs(x-x1)>Math.abs(y-y1))
         {   
             preventDocument(true);
         }else{
             preventDocument(false); 
         } 
      });
      dlistwrap.swipeLeft(function(){
          if(i>=l-1)
          {
             return false;
          }
          flx *= 1;
          i++;
          $(dlistwrap).css({'-webkit-transform':'translate('+(i*k)*flx+'px)','-webkit-transition':'-webkit-transform 500ms linear','transform':'translate('+(i*k)*flx+'px)','transition':'transform 500ms linear'});
          preventDocument(false);
      });
      dlistwrap.swipeRight(function(){
          if(i<=0)
          {
             return false;
          }
          flx *= 1;
          i--;
          $(dlistwrap).css({'-webkit-transform':'translate('+(i*k)*flx+'px)','-webkit-transition':'-webkit-transform 500ms linear','transform':'translate('+(i*k)*flx+'px)','transition':'transform 500ms linear'});
          preventDocument(false);
      });
      //阻止文档滑动影响左右滑动
      function preventDocument(flg)
      {
         if(flg)
         {
            $(g).on('touchmove',function(event){
             event.stopPropagation();
             return false;
            });
         }else{
            $(g).off('touchmove');
         }
      }    
   }).call(this);
   
   //下拉加载数据
   (function(){
       var g = (this===window) ? $(this) : $(window),
           allData = $("#allData"),
           pullUp = $('#pullUp'),
           pullUpLabel = null,
           text = '',
           page = 1,//从第二页开始
           loading = false,
           has_more = true,
           x0=0,x01=0,y0=0,y01=0,
           ishow = false,
           surl = 'test.php';
       if(allData.length<=0 || pullUp.length<=0)
       {
           return false;
       }
       pullUpLabel = pullUp.find('.pullUpLabel');
       text =  pullUpLabel.html();
       //滑动控制
       allData.scroll(function(){
          var h = $(this).scrollTop();
          var th = $(this).height();
          var bodyh = $(this)[0].scrollHeight;
          if(h+th>=bodyh && !loading)
          {   
              ishow = true;    
          }else{
              ishow = false; 
          }
          if(has_more===false)
          {
             ishow = false;
          } 
       });
        //控制拖拽样式
        allData.on('touchstart',function(event){
            x0 = event.touches[0].pageX;
            y0 = event.touches[0].pageY;
        });
        allData.on('touchmove',function(event){
            x01 = event.touches[0].pageX;
            y01 = event.touches[0].pageY;
            if(Math.abs(y0-y01)>Math.abs(x0-x01) && y0-y01>40 && ishow)
            {   
                if(has_more==false)
                {
                   pullUp.removeClass('flip');
                }else{
                   pullUp.addClass('flip');
                }
                pullUpLabel.html(text);
            }
        });
        //拖拽调用数据
        allData.swipeUp(function(event){
          if(ishow)
          {
             pullUp.removeClass('flip').addClass('loading');
             pullUpLabel.html('加载中...');
             setTimeout(function(){
                 loadData();
             },1000);
          }
          event.stopPropagation();
          return false;
        });
       //数据请求
       function loadData()
       {
           loading = true;
           if(has_more){
              page++;
              url = surl+'?page='+page;
              $.getJSON(url,function(data){
                      if(data.status)
                      {
                          $(data.html).insertBefore(pullUp);
                          has_more = data.has_more;
                          if(has_more===false)
                          {
                              pullUp.hide();
                              pullUpLabel.html(text);
                              pullUp.removeClass('flip').removeClass('loading'); 
                          }else{
                              pullUp.show();
                          }
                      }else{
                          has_more = false;
                          ishow = false;
                          pullUp.hide();
                      }
                      loading = false;
                      ishow = false;
                      pullUpLabel.html(text);
                      pullUp.removeClass('flip').removeClass('loading');
                      //幻灯效果调用
                      g[0].publicNumber.soliders();
              });
           }
       }
   }).call(this);
   //下拉加载数据
   /*(function(){
       var g = (this===window) ? $(this) : $(window),
           allData = $("#allData"),
           pullUp = $('#pullUp'),
           pullUpLabel = null,
           text = '',
           page = 1,
           loading = false,
           has_more = true,
           ishow = false,
           isEnd = false,
           x0=0,x01=0,y0=0,y01=0;
       if(allData.length<=0 || pullUp.length<=0)
       {
           return false;
       }
       pullUpLabel = pullUp.find('.pullUpLabel');
       text =  pullUpLabel.html();

       //滑动控制
       allData.scroll(function(){
          var h = $(this).scrollTop();
          var th = $(this).height();
          var bodyh = $(this)[0].scrollHeight;
          if(h+th>=bodyh && !loading)
          {   
              ishow = true;   
          }else{
              ishow = false; 
          }
          if(has_more===false)
          {
             ishow = false;
          }
       });
       //拖拽控制
       allData.on('touchstart',function(event){
            x0 = event.touches[0].pageX;
            y0 = event.touches[0].pageY;
       });
       allData.on('touchmove',function(event){
          x01 = event.touches[0].pageX;
          y01 = event.touches[0].pageY;
          if(Math.abs(y0-y01)>Math.abs(x0-x01) && y0-y01>40 && ishow)
          {   
              if(has_more==false)
              {
                 pullUp.removeClass('flip');
              }else{
                 pullUp.addClass('flip');
              }
              pullUpLabel.html(text);
          }
       });
       allData.on('touchend',function(event){
          if(Math.abs(y0-y01)>Math.abs(x0-x01) && y0-y01>40)
          {  
              if(ishow)
              {
                 pullUp.removeClass('flip').addClass('loading');
                 pullUpLabel.html('加载中...');
                 setTimeout(function(){
                     loadData();
                 },1000);
              }   
          }
       });
       //数据请求
       function loadData()
       {
           loading = true;
           if(has_more){
              page++;
              url = 'test.php?page='+page;
              $.getJSON(url,function(data){
                      if(data.status)
                      {
                          $(data.html).insertBefore(pullUp);
                          has_more = data.has_more;
                          if(has_more===false)
                          {
                              pullUp.hide();
                              pullUpLabel.html(text);
                              pullUp.removeClass('flip').removeClass('loading'); 
                          }else{
                              pullUp.show();
                          }
                      }else{
                          has_more = false;
                          ishow = false;
                          pullUp.hide();
                      }
                      loading = false;
                      ishow = false;
                      pullUpLabel.html(text);
                      pullUp.removeClass('flip').removeClass('loading');
                      //幻灯效果调用
                      g[0].publicNumber.soliders();
              });
           }
       }
   }).call(this);
   */
});

/*防止zepto与jquery冲突写法
(function(gobal,undef){
   var g = gobal===window ? gobal : false,
       $;
   if(g)
   {
      $ = gobal.Zepto ? gobal.Zepto : null;
      $(function(){
          console.log($);
      });
   }
})(window || null);
*/
